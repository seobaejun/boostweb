# Firestore 보안 규칙 가이드

이 문서는 `firestore.rules` 파일의 보안 규칙에 대한 설명입니다.

## 규칙 적용 방법

1. Firebase Console에 접속: https://console.firebase.google.com
2. 프로젝트 선택: `boostweb-93027`
3. Firestore Database → 규칙 탭으로 이동
4. `firestore.rules` 파일의 내용을 복사하여 붙여넣기
5. "게시" 버튼 클릭

또는 Firebase CLI를 사용하는 경우:

```bash
firebase deploy --only firestore:rules
```

## 보안 규칙 상세 설명

### Users 컬렉션 (`/users/{userId}`)

#### 읽기 권한 (read)
- ✅ **자신의 문서**: 모든 인증된 사용자는 자신의 문서를 읽을 수 있습니다.
- ✅ **Admin 권한**: Admin 역할을 가진 사용자는 모든 사용자 문서를 읽을 수 있습니다.
- ✅ **추천인 조회**: 인증된 사용자는 다른 사용자 문서를 읽어 추천인 정보를 확인할 수 있습니다.

#### 생성 권한 (create)
- ✅ **자신의 문서만 생성**: 사용자는 자신의 UID와 일치하는 문서만 생성할 수 있습니다.
- ✅ **필수 필드 검증**: `name`, `email`, `role` 필드가 필수입니다.
- ✅ **이메일 일치**: 저장되는 이메일이 인증된 사용자의 이메일과 일치해야 합니다.
- ✅ **역할 자동 설정**: 
  - `sprince1004@naver.com` → `admin`
  - 그 외 이메일 → `user`

#### 업데이트 권한 (update)
- ✅ **자신의 문서**: 사용자는 자신의 문서를 업데이트할 수 있습니다.
- ✅ **역할 변경 불가**: 일반 사용자는 자신의 역할을 변경할 수 없습니다.
- ✅ **이메일 변경 불가**: 이메일은 변경할 수 없습니다.
- ✅ **Admin 권한**: Admin은 모든 사용자 문서를 업데이트할 수 있습니다 (마이그레이션 등).

#### 삭제 권한 (delete)
- ✅ **자신의 문서**: 사용자는 자신의 문서를 삭제할 수 있습니다.
- ✅ **Admin 권한**: Admin은 모든 사용자 문서를 삭제할 수 있습니다.

### Contacts 컬렉션 (`/contacts/{contactId}`)

#### 읽기 권한 (read)
- ✅ **Admin 권한**: Admin은 모든 문의를 읽을 수 있습니다.
- ✅ **자신의 문의**: 사용자는 자신이 작성한 문의만 읽을 수 있습니다.

#### 생성 권한 (create)
- ✅ **인증된 사용자**: 모든 인증된 사용자는 문의를 생성할 수 있습니다.
- ✅ **필수 필드**: `name`, `phone`, `email`, `message`, `createdAt`, `status` 필드가 필수입니다.
- ✅ **이메일 일치**: 저장되는 이메일이 인증된 사용자의 이메일과 일치해야 합니다.
- ✅ **상태 제한**: 생성 시 상태는 `new`로만 설정 가능합니다.

#### 업데이트 권한 (update)
- ✅ **Admin만 가능**: Admin만 문의 상태를 업데이트할 수 있습니다.
- ✅ **제한된 필드**: `status`와 `updatedAt` 필드만 변경 가능합니다.

#### 삭제 권한 (delete)
- ✅ **Admin만 가능**: Admin만 문의를 삭제할 수 있습니다.

## 보안 고려사항

1. **역할 기반 접근 제어**: Admin 역할은 `sprince1004@naver.com` 이메일로만 자동 설정됩니다.
2. **이메일 검증**: 모든 생성 및 업데이트 작업에서 이메일이 인증된 사용자의 이메일과 일치하는지 확인합니다.
3. **역할 변경 방지**: 일반 사용자는 자신의 역할을 변경할 수 없습니다.
4. **기본 거부 정책**: 명시적으로 허용되지 않은 모든 작업은 거부됩니다.

## 테스트 방법

Firebase Console의 "규칙 시뮬레이터"를 사용하여 규칙을 테스트할 수 있습니다:

1. Firestore Database → 규칙 탭
2. "규칙 시뮬레이터" 클릭
3. 시나리오 입력 및 테스트 실행

## 주의사항

- 규칙 변경 후 즉시 적용되므로 주의가 필요합니다.
- 규칙에 오류가 있으면 Firestore 접근이 차단될 수 있습니다.
- 규칙 변경 전에 백업을 권장합니다.

